{"version":3,"file":"_createPlugin-904247f9.cjs","sources":["../src/config/createPlugin.ts"],"sourcesContent":["import {isString} from 'lodash'\nimport {Plugin, PluginOptions} from './types'\n\nexport type PluginFactory<TOptions> = (options: TOptions) => PluginOptions\n\nfunction validatePlugin(pluginResult: PluginOptions) {\n  // TODO: name is required etc\n  const messages = [\n    'projectId' in pluginResult && '`projectId` not allowed in plugin configuration',\n    'dataset' in pluginResult && '`dataset` not allowed in plugin configuration',\n  ].filter(isString)\n\n  if (messages.length)\n    throw new Error(\n      `Invalid plugin configuration:\\n${messages.map((message) => `\\t${message}`).join('\\n')}`\n    )\n}\n\n// interface Foo {\n//   s?: string\n//   // j?: number\n// }\n\n// type F<T> = Exclude<T[keyof T], undefined> extends never ? T : T | void\n\n// type X = F<Foo>\n\n// interface X\n\n// export function createPlugin<TOptions = void>(\n//   arg: PluginFactory<TOptions> | PluginOptions\n// ): Plugin<F<TOptions>>\nexport function createPlugin<TOptions = void>(\n  arg: PluginFactory<TOptions> | PluginOptions\n): Plugin<TOptions> {\n  if (typeof arg === 'function') {\n    const pluginFactory = arg\n\n    return (options: TOptions) => {\n      // TODO: there's a possiblity of passing default arguments to users'\n      // plugin factories or reading from default options in `TOptions`\n      const result = pluginFactory(options)\n\n      validatePlugin(result)\n      return result\n    }\n  }\n\n  validatePlugin(arg)\n  return () => arg\n}\n"],"names":["validatePlugin","pluginResult","messages","filter","isString","length","Error","map","message","join","createPlugin","arg","pluginFactory","options","result"],"mappings":";;;;AAKA,SAASA,cAAT,CAAwBC,YAAxB,EAAqD;EAEnD,MAAMC,QAAW,GAAA,CACf,eAAeD,YAAf,IAA+B,iDADhB,EAEf,aAAaA,YAAb,IAA6B,+CAFd,EAGfE,MAHe,CAGRC,MAAAA,CAAAA,QAHQ,CAAjB;EAKA,IAAIF,QAAS,CAAAG,MAAb,EACE,MAAM,IAAIC,KAAJ,0CAC8BJ,QAAA,CAASK,GAAT,CAAcC,OAAD,gBAAkBA,OAAlB,CAAb,EAA0CC,IAA1C,CAA+C,IAA/C,CAD9B,EAAN;AAGJ;;AAgBO,SAASC,YAAT,CACLC,GADK,EAEa;EACd,IAAA,OAAOA,GAAP,KAAe,UAAf,EAA2B;IAC7B,MAAMC,aAAgB,GAAAD,GAAtB;IAEA,OAAQE,OAAD,IAAuB;MAGtB,MAAAC,MAAA,GAASF,cAAcC,QAAvB;MAENb,cAAA,CAAec,MAAf,CAAA;MACO,OAAAA,MAAA;IACT,CAPA;EAQF;;EAEAd,cAAA,CAAeW,GAAf,CAAA;EACA,OAAO,MAAMA,GAAb;AACF;;"}