{"version":3,"file":"_deleteApiAction-c1ef8192.js","sources":["../src/cli/actions/graphql/deleteApiAction.ts"],"sourcesContent":["import type {CliCommandArguments, CliCommandContext} from '@sanity/cli'\n\nexport interface DeleteGraphQLApiFlags {\n  project?: string\n  dataset?: string\n  tag?: string\n}\n\nexport default async function deleteGraphQLApi(\n  args: CliCommandArguments<DeleteGraphQLApiFlags>,\n  context: CliCommandContext\n): Promise<void> {\n  const {apiClient, output, prompt} = context\n  const flags = args.extOptions\n\n  let client = apiClient({\n    requireUser: true,\n    requireProject: true,\n  }).config({apiVersion: '1'})\n\n  const projectId = flags.project ? `${flags.project}` : client.config().projectId\n  const dataset = flags.dataset ? `${flags.dataset}` : client.config().dataset\n  const tag = flags.tag ? `${flags.tag}` : 'default'\n\n  const confirmMessage =\n    tag === 'default'\n      ? `Are you absolutely sure you want to delete the current GraphQL API connected to the \"${dataset}\" dataset in project ${projectId}?`\n      : `Are you absolutely sure you want to delete the GraphQL API connected to the \"${dataset}\" dataset in project ${projectId}, tagged \"${tag}\"?`\n\n  const confirmedDelete = await prompt.single({\n    type: 'confirm',\n    message: confirmMessage,\n    default: false,\n  })\n\n  if (!confirmedDelete) {\n    return\n  }\n\n  if (projectId !== client.config().projectId) {\n    client = client.clone().config({projectId})\n  }\n\n  try {\n    await client.request({\n      url: `/apis/graphql/${dataset}/${tag}`,\n      method: 'DELETE',\n    })\n  } catch (err) {\n    throw err\n  }\n\n  output.print('GraphQL API deleted')\n}\n"],"names":["deleteGraphQLApi","args","context","apiClient","output","prompt","flags","extOptions","client","requireUser","requireProject","config","apiVersion","projectId","project","dataset","tag","confirmMessage","confirmedDelete","single","type","message","default","clone","request","url","method","err","print"],"mappings":"AAQ8B,eAAAA,gBAAA,CAC5BC,IAD4B,EAE5BC,OAF4B,EAGb;EACf,MAAM;IAACC,SAAD;IAAYC,MAAZ;IAAoBC;EAApB,IAA8BH,OAApC;EACA,MAAMI,QAAQL,IAAK,CAAAM,UAAnB;EAEA,IAAIC,SAASL,SAAU,CAAA;IACrBM,WAAa,EAAA,IADQ;IAErBC,cAAgB,EAAA;EAFK,CAAA,CAAV,CAGVC,MAHU,CAGH;IAACC,UAAA,EAAY;EAAb,CAHG,CAAb;EAKM,MAAAC,SAAA,GAAYP,MAAMQ,OAAN,aAAmBR,MAAMQ,OAAzB,IAAqCN,MAAA,CAAOG,MAAP,GAAgBE,SAAjE;EACA,MAAAE,OAAA,GAAUT,MAAMS,OAAN,aAAmBT,MAAMS,OAAzB,IAAqCP,MAAA,CAAOG,MAAP,GAAgBI,OAA/D;EACN,MAAMC,GAAM,GAAAV,KAAA,CAAMU,GAAN,aAAeV,MAAMU,GAArB,IAA6B,SAAzC;EAEM,MAAAC,cAAA,GACJD,QAAQ,SAAR,mGAC4FD,OAD5F,mCAC2HF,SAD3H,iGAEoFE,OAFpF,mCAEmHF,SAFnH,wBAEyIG,GAFzI,QADI;EAKA,MAAAE,eAAA,GAAkB,MAAMb,MAAA,CAAOc,MAAP,CAAc;IAC1CC,IAAM,EAAA,SADoC;IAE1CC,OAAS,EAAAJ,cAFiC;IAG1CK,OAAS,EAAA;EAHiC,CAAd,CAAxB;;EAMN,IAAI,CAACJ,eAAL,EAAsB;IACpB;EACF;;EAEA,IAAIL,SAAc,KAAAL,MAAA,CAAOG,MAAP,GAAgBE,SAAlC,EAA6C;IAC3CL,MAAA,GAASA,OAAOe,KAAP,GAAeZ,MAAf,CAAsB;MAACE;IAAD,CAAtB,CAAT;EACF;;EAEI,IAAA;IACF,MAAML,OAAOgB,OAAP,CAAe;MACnBC,GAAA,0BAAsBV,OAAtB,cAAiCC,GAAjC,CADmB;MAEnBU,MAAQ,EAAA;IAFW,CAAf,CAAN;GADE,QAKKC,KAAP;IACM,MAAAA,GAAA;EACR;;EAEAvB,MAAA,CAAOwB,KAAP,CAAa,qBAAb;AACF;;"}